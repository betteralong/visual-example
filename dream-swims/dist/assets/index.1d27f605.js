var e=Object.defineProperty,t=(t,s,r)=>(((t,s,r)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r})(t,"symbol"!=typeof s?s+"":s,r),r);import{A as s,G as r,a,S as n}from"./vendor.b3eb47af.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const r=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,n)=>{const i=new URL(e,r);if(self[t].moduleMap[i])return s(self[t].moduleMap[i]);const o=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){n(new Error(`Failed to import: ${e}`)),a(l)},onload(){s(self[t].moduleMap[i]),a(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("assets/");const i=new Array(1e4).fill(0);for(let d=50;d<60;d++)for(let e=50;e<70;e++)i[d+100*e]=1;class o{constructor(e){t(this,"items",[]),this.compare=e||((e,t)=>e-t)}enqueue(e){this.items.push(e)}dequeue(){if(!this.items.length)return;let e=0;for(let s=1;s<this.items.length;s++)this.compare(this.items[s],this.items[e])<0&&(e=s);const t=this.items[e];return this.items[e]=this.items[this.items.length-1],this.items.pop(),t}get length(){return this.items.length}}class l{constructor(e,s,r){t(this,"mapObstacles"),t(this,"target",[0,0]),t(this,"guide",!1),this.mapObstacles=e,this.player=s,this.container=r}bindPlayer(e){this.player=e}drawObstacles(){for(let e=0;e<100;e++)for(let t=0;t<100;t++)if(this.mapObstacles[e+100*t]){const s=new r;s.beginFill(6737151),s.drawRect(5*e,5*t,5,5),this.container.addChild(s)}}pathTo(e){const t=this,s=this.findPath(e);if(s)return new Promise(((e,r)=>{!function a(n){t.player.goto(5*s[n][0],5*s[n][1]).then((()=>{n<=0?e():a(n-1)})).catch((e=>{console.log(e),r()}))}(s.length-1)}))}findPath(e){let t=[].concat(this.mapObstacles),s={x:this.player.x/5,y:this.player.y/5};if(this.target[0]=parseInt(e.x/5),this.target[1]=parseInt(e.y/5),this.mapObstacles[this.target[0]+100*this.target[1]])return;console.log(`从(${s.x}，${s.y})移动到${this.target[0]}，${this.target[1]})移动到`);const r=new o(this.distance.bind(this));function a(e,s,a){e<0||e>=100||s<0||s>=100||t[e+100*s]||(t[e+100*s]=a,r.enqueue([e,s]))}for(r.enqueue([s.x,s.y]);r.length;){let[e,n]=r.dequeue();if(e===this.target[0]&&n===this.target[1]){console.log("找到路了");let r=[];for(;e!=s.x||n!=s.y;){r.push(t[e+100*n]);let s=e,a=n;e=t[s+100*a][0],n=t[s+100*a][1]}return r}[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]].forEach((t=>{a(e+t[0],n+t[1],[e,n])}))}}distance(e,t){return Math.pow(e[0]-this.target[0],2)+Math.pow(e[1]-this.target[1],2)-(Math.pow(t[0]-this.target[0],2)+Math.pow(t[1]-this.target[1],2))}}class c extends a{constructor(e){super(e),this.anchor.set(.5,.85),this.position.set(100,100),this.animationSpeed=.1,this.play()}goto(e,t){return new Promise((s=>{setTimeout((()=>{this.position.set(e,t),s()}),60)}))}}const h=function(){const e=new s({width:500,height:500,view:document.getElementById("canvas"),antialias:!0,transparent:!1,resolution:1});return e.view.oncontextmenu=e=>{e.preventDefault()},e}();let u,p;h.loader.add([{name:"background",url:"background/bg.jpg"},{name:"player",url:"player/0.png"},{name:"player1",url:"player/1.png"},{name:"player2",url:"player/2.png"},{name:"player3",url:"player/3.png"},{name:"player4",url:"player/4.png"},{name:"player5",url:"player/5.png"}]).load((function(){!function(){const e=h.loader.resources.background.texture,t=new n(e);h.stage.addChild(t),p=new c([h.loader.resources.player1.texture,h.loader.resources.player2.texture,h.loader.resources.player3.texture,h.loader.resources.player4.texture,h.loader.resources.player5.texture]),u=new l(i,p,h.stage),u.drawObstacles(),h.stage.addChild(p),h.stage.interactive=!0,h.stage.on("click",(e=>{const{x:t,y:s}=e.data.global;u.pathTo({x:t,y:s})}))}()}));
